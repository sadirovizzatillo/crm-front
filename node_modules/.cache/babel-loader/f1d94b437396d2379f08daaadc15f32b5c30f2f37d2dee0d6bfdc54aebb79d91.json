{"ast":null,"code":"import { defineStore } from \"pinia\";\nimport Request from \"@/api\";\nimport { useCore } from \"./core.pinia.js\";\nexport const useUsers = defineStore('user', {\n  state: () => ({\n    token: null,\n    user_me: null,\n    isUser: false,\n    loading: true,\n    loader: false\n  }),\n  getters: {},\n  actions: {\n    getToken(data) {\n      this.loader = true;\n      Request({\n        url: 'v1/auth/token',\n        method: 'post',\n        data: data\n      }).then(res => {\n        localStorage.setItem('_zToken', res.data?.['access_token']);\n        this.token = res.data?.['access_token'];\n        useCore().redirect('/');\n      }).catch(error => {\n        useCore().setToast({\n          type: 'message',\n          message: error.response.statusText,\n          status: 'error'\n        });\n      }).finally(() => {\n        this.loader = false;\n      });\n    },\n    getUserMe(redirect = false, isLogin = false) {\n      const token = localStorage.getItem('_zToken');\n      if (token && token.trim().length) {\n        return Request({\n          url: 'v1/user/me',\n          method: 'get'\n        }).then(res => {\n          this.user_me = res.data;\n          this.isUser = true;\n          if (redirect) {\n            useCore().redirect('/');\n          }\n        }).catch(error => {\n          console.log(error);\n          const {\n            status,\n            data,\n            message\n          } = error.response;\n          if (status === 403) {\n            localStorage.removeItem('_zToken');\n            window.location.href = '/login';\n          } else {\n            useCore().setToast({\n              type: 'message',\n              status: 'error',\n              message: data && typeof data === \"string\" ? data : message\n            });\n          }\n        }).finally(() => {\n          this.loading = false;\n        });\n      }\n      localStorage.removeItem('_zToken');\n      window.location.href = '/login';\n    },\n    setLoading() {\n      this.loading = !this.loading;\n    }\n  }\n});","map":{"version":3,"names":["defineStore","Request","useCore","useUsers","state","token","user_me","isUser","loading","loader","getters","actions","getToken","data","url","method","then","res","localStorage","setItem","redirect","catch","error","setToast","type","message","response","statusText","status","finally","getUserMe","isLogin","getItem","trim","length","console","log","removeItem","window","location","href","setLoading"],"sources":["/Users/air/Documents/crm/src/store/users.pinia.js"],"sourcesContent":["import {defineStore} from \"pinia\";\nimport Request from \"@/api\";\nimport {useCore} from \"./core.pinia.js\";\n\nexport const useUsers = defineStore('user', {\n    state: () => ({\n        token: null,\n        user_me: null,\n        isUser: false,\n        loading: true,\n        loader: false\n    }),\n    getters: {},\n    actions: {\n        getToken(data) {\n            this.loader = true;\n            Request({\n                url: 'v1/auth/token',\n                method: 'post',\n                data: data\n            }).then((res) => {\n                localStorage.setItem('_zToken', res.data?.['access_token']);\n                this.token = res.data?.['access_token'];\n                useCore().redirect('/');\n            }).catch((error) => {\n                useCore().setToast({\n                    type: 'message',\n                    message: error.response.statusText,\n                    status: 'error'\n                })\n            }).finally(() => {\n                this.loader = false;\n            })\n        },\n        getUserMe(redirect = false, isLogin = false) {\n            const token = localStorage.getItem('_zToken');\n            if (token && token.trim().length) {\n                return Request({\n                    url: 'v1/user/me',\n                    method: 'get'\n                })\n                .then((res) => {\n                    this.user_me = res.data;\n                    this.isUser = true;\n                    if (redirect) {\n                        useCore().redirect('/');\n                    }\n                })\n                .catch((error) => {\n                    console.log(error);\n                    const {status, data, message} = error.response;\n                    if (status === 403) {\n                        localStorage.removeItem('_zToken');\n                        window.location.href = '/login';\n                    } else {\n                        useCore().setToast({\n                            type: 'message',\n                            status: 'error',\n                            message: data && typeof data === \"string\" ? data : message\n                        })\n                    }\n                })\n                .finally(() => {\n                    this.loading = false;\n                })\n            }\n            localStorage.removeItem('_zToken');\n            window.location.href = '/login';\n        },\n        setLoading() {\n            this.loading = !this.loading;\n        }\n    }\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}